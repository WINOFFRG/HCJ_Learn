<html>
    <head>
        <link rel="stylesheet" href="font-awesome.min.css">
        <style>
        body{
            margin: 0;
            padding: 0;
            border: 2px solid #eee;
            user-select: none
        }
        #title-bar{
            height: 20px;
            background: #111;
            overflow: hidden;
            border-bottom: 2px solid #eee;
            cursor: context-menu;
        }
        #title-name{
            -webkit-app-region: drag;
            width: calc(100% - 170px);
            padding: 3px;
            color: #fff;
            font-size: 12px;
            font-family: sans-serif;
            vertical-align: top;
            display: inline-block;
        }
        #logoimg{
            display: inline-block;
            width: 15px;
        }
        #title-logo{
            -webkit-app-region: drag;
            padding: 2px;
            display: inline-block;
        }
        #title-icons{
            width: 120px;
            float: right;
            color: #fff;
            padding: 3px;
            font-size: 14px;
            text-align: right;
        }
        #icons{margin-right: 2px}
        .jw-settings-topbar{height: 50px !important;}
        </style>
        </head>
    <body>
        <div id="title-bar">
            <div id="title-logo">
                <img src="../images/logo.png" id="logoimg">
            </div>
            <div id="title-name"></div>
            <div id="title-icons">
                <span id="icons" onclick="$('#pcsub').click()"><i class="fa fa-cc" title="Local Subtitle"></i></span>
                <span id="icons"><i class="fa fa-arrows-alt" id="aspect-ratio" title="Ratio"></i></span>
                <span id="icons"><i class="fa fa-toggle-off" id="float-btn" title="Float over other apps"></i></span>
                <span id="icons"><i class="fa fa-window-minimize" id="win-minbtn"></i></span>
                <span id="icons"><i class="fa fa-window-maximize" id="win-maxbtn"></i></span>
                <span id="icons"><i class="fa fa-window-close" id="win-clsbtn"></i></span>
            </div>
        </div>

        <div id="player">
            <script type="text/javascript" src="jwplayer.min.js"></script>
            <script> jwplayer.key="0vdtGaRnWNZOgHE3rhHEY6SAv6M7jGb8z9qbGw==";</script>

        </div>
        <input type="file" accept=".vtt, .srt" style="display: none;" id="pcsub" onchange="loadsub(this)">
        <script>window.$ = window.jQuery = require('jquery');</script>
        <script>
            let ipc = require('electron').ipcRenderer;
            let remote= require('electron').remote;

            $('#aspect-ratio').click(function() {
                var videotag = document.getElementsByTagName("video")[0]; 
                checkshit = videotag.style.objectFit;
                if (checkshit == "fill") {
                    videotag.style.objectFit = "contain";
                } else {
                    videotag.style.objectFit = "fill";
                }
            });

            document.getElementById('float-btn').addEventListener('click', () => {
                const currentWindow = remote.getCurrentWindow()
                if(currentWindow.isAlwaysOnTop()) {
                    currentWindow.setAlwaysOnTop(false);
                    $('#float-btn').removeClass('fa-toggle-on').addClass('fa-toggle-off');
                } else {
                    currentWindow.setAlwaysOnTop(true);
                    $('#float-btn').removeClass('fa-toggle-off').addClass('fa-toggle-on');
                }
            })

            document.getElementById('win-minbtn').addEventListener('click', () => {
                remote.getCurrentWindow().minimize()
            })

            document.getElementById('win-maxbtn').addEventListener('click', () => {
                const currentWindow = remote.getCurrentWindow()
                if(currentWindow.isMaximized()) {
                    currentWindow.unmaximize()
                } else {
                    currentWindow.maximize()
                }
            })
            remote.getCurrentWindow().on('maximize', ()=>{
                $('#win-maxbtn').removeClass('fa-window-maximize').addClass('fa-window-restore');
            });
            remote.getCurrentWindow().on('unmaximize', ()=>{
                $('#win-maxbtn').removeClass('fa-window-restore').addClass('fa-window-maximize');
            });

            document.getElementById('win-clsbtn').addEventListener('click', () => {
                const currentWindow = remote.getCurrentWindow()
                currentWindow.close()
            })

            ipc.on('link', (event, link) => {
                ipc.on('lic', (event, lic) => {
                    ipc.on('text', (event, text) => {
                        loadplayer(link,lic,text);
                    });
                });
            });
            ipc.on('name', (event, message) => {
                document.title=message; 
                $('#title-name').html(message);
            });

            var vlink = "https://hses5.hotstar.com/videos/hotstarint/1260063451/1260063525/1623120293813/967d88347ea15f8116016b31097dd614/master-bb8769e8a8-phone-0.mpd?hdnea=st=1624207397~exp=1624207997~acl=/videos/hotstarint/1260063451/1260063525/1623120293813/967d88347ea15f8116016b31097dd614/*~data=ip=02019abb8829273d1647bc4d1e6963b248ebffe8133a91d3c15a2baf4dac-userid=cfa78478a098a72f17d02c845875b712dfb34bed6d9819eacb82bf97d4fcd2d7-~hmac=fff0faa3d7a92ad282f817cb2a2fa87b6721889710225b6ba651bc5127042705";
            var vlic = "https://ipl.service.expressplay.com/hms/wv/rights/?ExpressPlayToken=BQAAABNlKeEAJDIxNmZiODg3LWZjNTUtNGJiNS1iMTg1LTA4MjFiMDk1MjhjNQAAALA_Qfvrx1CRjGUkRTRZ2OLz3djcwbAMoBwyrVGZGMisTllHBMPUsy6r5IntI1KO52c-o6r9R-BwZNFZ5rVqf45Gd2dNW14-u6DNKUmbYcqOV0vdMTk2eyTitxo1_ilcLrMIVQKf6FGsaw0llFsszaO8pN5Af0oKbFMoUzYmB5Wl9g6TOkpc1B564Wyj_lRnu17Hs5T9bLYwjMy261IXb30fujSbUKnzTkHA-79cNaPGfCDyw-NM_3SWIA87TfNa3JIQ5pPa";
            var text = "Video";
            function loadplayer(link,lic,text){
                vlink = link;
                vlic = lic;
                var player = jwplayer("player").setup({
                    "type":"mpd",
                    "file":link,
                	"drm": {
            			"widevine": {"url": lic}
          			},
                	tracks: [{ 
            			file: text, 
            			label: "English",
            			kind: "captions",
          				"default": true 
        			}],
                    stretching:"fill",
                    'width':'100%',
                    height:'calc(100% - 22px)',
                    autostart: true,
                    playbackRateControls: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 2, 2.5, 3],
                    "abouttext":"Powered by ThopTV"
                });
                player.addButton("http://cdn.thop.filecloud.monster/uploads/cache/ratio.svg", "Change Aspect Ratio", function () {
                    var videotag = document.getElementsByTagName("video")[0]; 
                    checkshit = videotag.style.objectFit;
                    if (checkshit == "fill") {
                        videotag.style.objectFit = "contain";
                    } else {
                        videotag.style.objectFit = "fill";
                    }
                }, "button-ar");
                
            }
            loadplayer(vlink,vlic,text);
            
            function loadsub(input){
                if (input.files && input.files[0]) {
                    var extension = input.files[0].name.split('.').pop().toLowerCase();
                    if(extension != "srt" && extension != "vtt"){
                        alert('SRT or VTT File.');
                        return false;
                    }
                    var reader = new FileReader();
                    reader.readAsText(input.files[0]);
                    reader.onload = function (e) {
                        var surl = URL.createObjectURL(input.files[0]);
                        loadplayer(vlink,vlic,surl);
                    }
                }
            }

        </script>
    </body>
</html>
